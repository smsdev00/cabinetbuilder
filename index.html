<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Medidas y Tablas MDF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        #app {
            max-width: 900px; /* Un poco más de ancho para nueva info */
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .card {
            margin-bottom: 1.5rem;
        }
        /* Estilo para resaltar el resultado */
        .resultado-tablas {
            font-size: 1.25rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app" class="container mt-4 mb-5">
        <h1 class="mb-4 text-center">Calculadora de Mueble y Tablas MDF</h1>

        <div class="card shadow-sm">
            <div class="card-header">
                Dimensiones del Mueble y Material
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6 col-lg-3">
                        <label for="largo" class="form-label">Largo Base (cm):</label>
                        <input type="number" id="largo" class="form-control" v-model.number="largo" min="1">
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <label for="ancho" class="form-label">Ancho Base (cm):</label>
                        <input type="number" id="ancho" class="form-control" v-model.number="ancho" min="1">
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <label for="alto" class="form-label">Alto Total (cm):</label>
                        <input type="number" id="alto" class="form-control" v-model.number="alto" min="1">
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <label for="espesor" class="form-label">Espesor Material (mm):</label>
                        <input type="number" id="espesor" class="form-control" v-model.number="espesor" min="1" step="0.1">
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header">
                Dimensiones de la Tabla de MDF
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="sheetHeight" class="form-label">Alto Tabla (cm):</label>
                        <input type="number" id="sheetHeight" class="form-control" v-model.number="sheetHeight" min="1">
                    </div>
                    <div class="col-md-4">
                        <label for="sheetWidth" class="form-label">Ancho Tabla (cm):</label>
                        <input type="number" id="sheetWidth" class="form-control" v-model.number="sheetWidth" min="1">
                    </div>
                    <div class="col-md-4">
                        <label for="sheetPrice" class="form-label">Precio Tabla (cm):</label>
                        <input type="number" id="sheetPrice" class="form-control" v-model.number="sheetPrice" min="1">
                    </div>
                </div>
            </div>
        </div>

         <div class="card shadow-sm">
            <div class="card-header">
                Resultados del Cálculo
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <span class="resultado-tablas">Tablas de MDF necesarias: {{ resultadoCorte.count >= 0 ? resultadoCorte.count : 'Calculando...' }} <br>Costo: {{sheetPrice*resultadoCorte.count}}</span>
                     <p v-if="resultadoCorte.count > 0" class="text-muted small mt-2">
                       Estimación basada en heurística simple. La disposición real puede variar.
                    </p>
                     <p v-if="resultadoCorte.error" class="text-danger small mt-2">
                       {{ resultadoCorte.error }}
                    </p>
                </div>

                <h3 class="fs-5 mt-4 mb-3 text-center">Despiece Detallado</h3>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Etiqueta</th>
                                <th>Cantidad</th>
                                <th>Medida 1 (cm)</th>
                                <th>Medida 2 (cm)</th>
                                <th>Notas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="piezasCalculadas.length === 0 || piezasCalculadas[0].etiqueta === 'Error'">
                                <td colspan="5" class="text-center fst-italic">{{ piezasCalculadas.length > 0 ? piezasCalculadas[0].dim1 : 'Ingrese dimensiones válidas para calcular.' }}</td>
                            </tr>
                            <tr v-else v-for="pieza in piezasCalculadas" :key="pieza.etiqueta">
                                <td>{{ pieza.etiqueta }}</td>
                                <td>{{ pieza.cantidad }}</td>
                                <td>{{ formatDecimal(pieza.dim1) }}</td>
                                <td>{{ formatDecimal(pieza.dim2) }}</td>
                                <td>{{ pieza.nota || '-' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <p class="text-center text-muted mt-4 small">
            Nota sobre Despiece: Cálculo basado en una construcción simple de caja (laterales cubren cantos base/tapa, frente/trasera entre laterales).
        </p>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                // --- Estado Reactivo (Data) ---
                const largo = ref(80);
                const ancho = ref(80);
                const alto = ref(160);
                const espesor = ref(9); // mm
                const sheetHeight = ref(260); // cm - Alto tabla por defecto
                const sheetWidth = ref(183); // cm - Ancho tabla por defecto
                const sheetPrice = ref(25000);
                // --- Propiedades Calculadas (Computed) ---

                // Calcula las piezas individuales del mueble
                const piezasCalculadas = computed(() => {
                    const L = parseFloat(largo.value);
                    const A = parseFloat(ancho.value);
                    const H = parseFloat(alto.value);
                    const E_mm = parseFloat(espesor.value);

                    if (isNaN(L) || isNaN(A) || isNaN(H) || isNaN(E_mm) || L <= 0 || A <= 0 || H <= 0 || E_mm <= 0) {
                        return [];
                    }

                    const E_cm = E_mm / 10;

                    if (L <= 2 * E_cm) {
                         return [{ etiqueta: 'Error', cantidad: '-', dim1: 'Largo insuficiente para el espesor', dim2: '-', nota: 'Ajuste las medidas' }];
                    }
                    if (A <= 0) {
                         return [{ etiqueta: 'Error', cantidad: '-', dim1: 'Ancho inválido', dim2: '-', nota: 'Ajuste las medidas' }];
                    }
                     if (H <= 0) {
                         return [{ etiqueta: 'Error', cantidad: '-', dim1: 'Alto inválido', dim2: '-', nota: 'Ajuste las medidas' }];
                    }


                    const piezas = [
                        { etiqueta: 'Base', cantidad: 1, dim1: L, dim2: A, nota: 'Pieza inferior' },
                        { etiqueta: 'Tapa', cantidad: 1, dim1: L, dim2: A, nota: 'Pieza superior' },
                        { etiqueta: 'Lateral', cantidad: 2, dim1: H, dim2: A, nota: 'Caras laterales' },
                        { etiqueta: 'Frente', cantidad: 1, dim1: H, dim2: L - (2 * E_cm), nota: 'Pieza frontal' },
                        { etiqueta: 'Trasera', cantidad: 1, dim1: H, dim2: L - (2 * E_cm), nota: 'Pieza posterior' }
                    ];

                    // Filtrar piezas si alguna dimensión calculada es <= 0
                    return piezas.filter(p => p.dim1 > 0 && p.dim2 > 0);
                });

                // Calcula cuántas tablas se necesitan (heurística simple)
                const resultadoCorte = computed(() => {
                    const piezas = piezasCalculadas.value;
                    const sh = parseFloat(sheetHeight.value);
                    const sw = parseFloat(sheetWidth.value);

                    // Validaciones
                    if (!piezas || piezas.length === 0 || piezas[0].etiqueta === 'Error') {
                        return { count: 0, error: piezas[0]?.dim1 || "Calcule primero el despiece del mueble." };
                    }
                     if (isNaN(sh) || isNaN(sw) || sh <= 0 || sw <= 0) {
                         return { count: 0, error: "Dimensiones de tabla MDF inválidas." };
                     }

                    // 1. Expandir lista de piezas por cantidad y calcular área
                    let todasLasPiezas = [];
                    let errorDimensionPieza = false;
                    piezas.forEach(tipoPieza => {
                        for (let i = 0; i < tipoPieza.cantidad; i++) {
                            // Validar que las dimensiones de la pieza quepan en la tabla (en al menos una orientación)
                             if (!((tipoPieza.dim1 <= sh && tipoPieza.dim2 <= sw) || (tipoPieza.dim1 <= sw && tipoPieza.dim2 <= sh))) {
                                errorDimensionPieza = `La pieza '${tipoPieza.etiqueta}' (${formatDecimal(tipoPieza.dim1)} x ${formatDecimal(tipoPieza.dim2)} cm) no cabe en una tabla de ${sh} x ${sw} cm.`;
                                // No continuar si una pieza no cabe
                                break;
                            }
                            todasLasPiezas.push({
                                w: tipoPieza.dim1, // Usaremos w y h genéricamente
                                h: tipoPieza.dim2,
                                area: tipoPieza.dim1 * tipoPieza.dim2
                            });
                        }
                         if (errorDimensionPieza) return; // Salir del forEach si hay error
                    });

                    // Si hubo error de dimensión, retornar
                     if (errorDimensionPieza) {
                        return { count: 0, error: errorDimensionPieza };
                    }

                    // 2. Ordenar piezas (mayor área primero - heurística)
                    todasLasPiezas.sort((a, b) => b.area - a.area);

                    // 3. Simular llenado de tablas (heurística simple de área y dimensiones)
                    const sheetAreaTotal = sw * sh;
                    let sheets = []; // Array para llevar registro de las tablas usadas

                    for (const pieza of todasLasPiezas) {
                        let placed = false;
                        // Buscar en tablas existentes
                        for (let i = 0; i < sheets.length; i++) {
                            // Comprobación MUY BÁSICA de dimensiones y área restante
                            const sheet = sheets[i];
                            const canFitDim = (pieza.w <= sheet.maxWidth && pieza.h <= sheet.maxHeight) || (pieza.h <= sheet.maxWidth && pieza.w <= sheet.maxHeight);
                            const hasEnoughArea = sheet.remainingArea >= pieza.area;

                            if (canFitDim && hasEnoughArea) {
                                // Colocarla (solo descontamos área como heurística)
                                sheet.remainingArea -= pieza.area;
                                placed = true;
                                break; // Pasar a la siguiente pieza
                            }
                        }

                        // Si no cupo en ninguna existente, añadir nueva tabla
                        if (!placed) {
                            // Verificar si la pieza cabe en una tabla nueva (ya hecho antes, pero por si acaso)
                             if (!((pieza.w <= sh && pieza.h <= sw) || (pieza.w <= sw && pieza.h <= sh))) {
                                 // Esto no debería pasar si la validación inicial funcionó
                                 console.error("Error lógico: Pieza no cabe en tabla nueva.");
                                 return { count: 0, error: "Error interno en cálculo de tablas." };
                             }
                            sheets.push({
                                id: sheets.length + 1,
                                remainingArea: sheetAreaTotal - pieza.area,
                                maxWidth: sw, // Mantenemos las dims originales para la comprobación 'canFitDim'
                                maxHeight: sh
                            });
                        }
                    } // Fin del loop por cada pieza

                    return { count: sheets.length, error: null }; // El resultado es cuántas tablas se inicializaron
                });


                // --- Métodos ---
                const formatDecimal = (value) => {
                    if (typeof value === 'number') {
                         return value.toFixed(2);
                    }
                    return value;
                };

                // --- Exponer al Template ---
                return {
                    largo,
                    ancho,
                    alto,
                    espesor,
                    sheetHeight,
                    sheetWidth,
                    sheetPrice,
                    piezasCalculadas,
                    resultadoCorte,
                    formatDecimal
                };
            }
        }).mount('#app');
    </script>

</body>
</html>